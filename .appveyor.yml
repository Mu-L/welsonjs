version: 0.2.7.build{build}

image: Visual Studio 2019

clone_folder: C:\projects\welsonjs

environment:
  ORGANIZATION_ID: 8ee5ec82-36dc-4619-ac33-5bc1117428fe
  PROJECT_SLUG: welsonjs
  SIGNING_POLICY_SLUG: test-signing
  ARTIFACT_CONFIGURATION_SLUG: initial
  ENCRYPTED_SIGNPATH_API_TOKEN: QFoVIYbkJCRnFrvSC1anTqXIsF32ulGlAmFtlgGCpqA9Fe1viuAcnej0lcBhMYsp5LN1FyworTFcWjE7AmHrWA==
  matrix:
    - CONFIGURATION: Debug
    - CONFIGURATION: Release

before_build:
  - nuget restore WelsonJS.Toolkit

build_script:
  - msbuild "C:\projects\welsonjs\WelsonJS.Toolkit\WelsonJS.Toolkit.sln" /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /p:Configuration=%CONFIGURATION% /p:Platform="x86"

after_build:
  - cmd: 7z a WelsonJS.Toolkit.zip WelsonJS.Toolkit\WelsonJS.Toolkit\bin\x86\%CONFIGURATION%\*
  - cmd: 7z a WelsonJS.Service.zip WelsonJS.Toolkit\WelsonJS.Service\bin\x86\%CONFIGURATION%\*
  - cmd: 7z a WelsonJS.Launcher.zip WelsonJS.Toolkit\WelsonJS.Launcher\bin\x86\%CONFIGURATION%\*

artifacts:
  - path: WelsonJS.Toolkit.zip
    name: WelsonJS.Toolkit
  - path: WelsonJS.Service.zip
    name: WelsonJS.Service
  - path: WelsonJS.Launcher.zip
    name: WelsonJS.Launcher

deploy:
- provider: Webhook
  url: https://app.signpath.io/API/v1/$ORGANIZATION_ID/Integrations/AppVeyor?ProjectSlug=$PROJECT_SLUG&SigningPolicySlug=$SIGNING_POLICY_SLUG&ArtifactConfigurationSlug=$ARTIFACT_CONFIGURATION_SLUG
  authorization:
    secure: $ENCRYPTED_SIGNPATH_API_TOKEN

notifications:
  - provider: Email
    to:
      - abuse@catswords.net
    subject: 'Build #{{build}} {{status}}'
    on_build_success: false
    on_build_failure: true
